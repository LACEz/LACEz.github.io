window.__require=function t(e,r,i){function o(n,s){if(!r[n]){if(!e[n]){var a=n.split("/");if(a=a[a.length-1],!e[a]){var p="function"==typeof __require&&__require;if(!s&&p)return p(a,!0);if(c)return c(a,!0);throw new Error("Cannot find module '"+n+"'")}n=a}var h=r[n]={exports:{}};e[n][0].call(h.exports,function(t){return o(e[n][1][t]||t)},h,h.exports,t,e,r,i)}return r[n].exports}for(var c="function"==typeof __require&&__require,n=0;n<i.length;n++)o(i[n]);return o}({Jumper:[function(t,e,r){"use strict";cc._RF.push(e,"fa464hRlHVHLZ62VIxnQX4k","Jumper");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),c=this&&this.__decorate||function(t,e,r,i){var o,c=arguments.length,n=c<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(n=(c<3?o(n):c>3?o(e,r,n):o(e,r))||n);return c>3&&n&&Object.defineProperty(e,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});var n=t("./brick"),s=cc._decorator,a=s.ccclass,p=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curBrickData=null,e.isJumping=!1,e}return o(e,t),e.prototype.start=function(){},e.prototype.setBrickData=function(t){this.curBrickData=t,this.fitDir(this.curBrickData.dir)},e.prototype.getCurBrickData=function(){return this.curBrickData},e.prototype.fitDir=function(t){this.node.scaleX=t===n.BirckDir.right?.3:-.3},e.prototype.jump=function(t){if(!this.isJumping){this.fitDir(t);var e=this.findNextBrick(t);e?this.nextJump(e):this.JumpDown(t)}},e.prototype.JumpDown=function(t){var e=this;this.isJumping=!0;var r=t===n.BirckDir.right?62.5:-62.5,i=this.node.y+72,o=this.node.x+r,c=this.curBrickData.brick.getSiblingIndex();cc.tween(this.node).parallel(cc.tween().to(.1,{x:o}),cc.tween().to(.07,{y:i+50}).to(.03,{y:i})).call(function(){e.node.setSiblingIndex(c)}).by(.8,{y:-972}).call(function(){e.isJumping=!1,cc.systemEvent.emit("GameOver")}).start()},e.prototype.startFall=function(t){var e=this;this.curBrickData!==t||this.isJumping||(this.isJumping=!0,cc.tween(this.node).by(.8,{y:-1e3}).call(function(){e.isJumping=!1,cc.systemEvent.emit("GameOver")}).start())},e.prototype.nextJump=function(t){var e=this;this.isJumping=!0,cc.tween(this.node).parallel(cc.tween().to(.1,{x:t.pos.x}),cc.tween().to(.07,{y:t.pos.y+30}).to(.03,{y:t.pos.y})).call(function(){e.isJumping=!1,e.curBrickData=t,e.curBrickData.hasJumperStand=!0,e.curBrickData.isDeathWay?cc.systemEvent.emit("GameOver"):cc.systemEvent.emit("jumpFinish")}).start()},e.prototype.findNextBrick=function(t){for(var e=0,r=this.curBrickData.child;e<r.length;e++){var i=r[e];if(i.dir===t)return i}return null},e.prototype.reset=function(){this.isJumping=!1,this.curBrickData=null,this.node.position=cc.v3(0,0,0)},c([a],e)}(cc.Component));r.default=p,cc._RF.pop()},{"./brick":"brick"}],app:[function(t,e,r){"use strict";cc._RF.push(e,"1d46bIj3k1B+oUAhnS9IgNV","app");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),c=this&&this.__decorate||function(t,e,r,i){var o,c=arguments.length,n=c<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(n=(c<3?o(n):c>3?o(e,r,n):o(e,r))||n);return c>3&&n&&Object.defineProperty(e,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});var n=t("./brick"),s=t("./brickMgr"),a=t("./Jumper"),p=cc._decorator,h=p.ccclass,u=p.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.jumper=null,e.brickMgr=null,e.clickLayer=null,e.gameOverLayer=null,e.lb_score=null,e._score=0,e}var r;return o(e,t),r=e,Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t,this.updateScore()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){r.instance=this},e.prototype.onEnable=function(){},e.prototype.onDisable=function(){this.unRegister()},e.prototype.onDestroy=function(){r.instance=null},e.prototype.start=function(){this.startGame()},e.prototype.startGame=function(){this.brickMgr.createDefaultBricks();var t=this.brickMgr.getBrickTree();this.jumper.setBrickData(t.root),this.register()},e.prototype.jumpFinish=function(){this.score+=1,this.brickMgr.treeGrowth(),cc.systemEvent.emit("cameraFollow",!1),this.brickMgr.startFallBricks()},e.prototype.brickFalling=function(t){this.jumper.startFall(t)},e.prototype.GameOver=function(){this.unRegister(),cc.log("GameOver"),this.gameOverLayer.active=!0,this.gameOverLayer.opacity=0,this.gameOverLayer.runAction(cc.fadeIn(.2)),this.gameOverLayer.getChildByName("text_score").getComponent(cc.Label).string=this.score.toString(),this.brickMgr.stopFalling()},e.prototype.register=function(){this.clickLayer.on("touchend",this.onClick,this),cc.systemEvent.on("jumpFinish",this.jumpFinish,this),cc.systemEvent.on("GameOver",this.GameOver,this),cc.systemEvent.on("brickFalling",this.brickFalling,this)},e.prototype.unRegister=function(){this.clickLayer.off("touchend",this.onClick,this),cc.systemEvent.off("jumpFinish",this.jumpFinish,this),cc.systemEvent.off("GameOver",this.GameOver,this),cc.systemEvent.off("brickFalling",this.brickFalling,this)},e.prototype.onClick=function(t){var e=t.getLocationX()>cc.winSize.width/2?n.BirckDir.right:n.BirckDir.left;this.jumper.jump(e)},e.prototype.updateScore=function(){this.lb_score.string=this.score.toString()},e.prototype.restart=function(){this.score=0,this.gameOverLayer.active=!1,this.jumper.reset(),cc.systemEvent.emit("cameraFollow",!0),this.brickMgr.clearTree(),this.startGame()},e.instance=null,c([u(a.default)],e.prototype,"jumper",void 0),c([u(s.default)],e.prototype,"brickMgr",void 0),c([u(cc.Node)],e.prototype,"clickLayer",void 0),c([u(cc.Node)],e.prototype,"gameOverLayer",void 0),c([u(cc.Label)],e.prototype,"lb_score",void 0),r=c([h],e)}(cc.Component);r.default=l,globalThis.GM=l,cc._RF.pop()},{"./Jumper":"Jumper","./brick":"brick","./brickMgr":"brickMgr"}],brickMgr:[function(t,e,r){"use strict";cc._RF.push(e,"1e2c2NEgj1Imas2qkIZ+lx+","brickMgr");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),c=this&&this.__decorate||function(t,e,r,i){var o,c=arguments.length,n=c<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(n=(c<3?o(n):c>3?o(e,r,n):o(e,r))||n);return c>3&&n&&Object.defineProperty(e,r,n),n};Object.defineProperty(r,"__esModule",{value:!0}),r.brickTree=r.brickData=void 0;var n=t("./brick"),s=cc._decorator,a=s.ccclass,p=s.property,h=function(){function t(t,e){void 0===e&&(e=!1),this.dir=n.BirckDir.right,this._parent=null,this.child=[],this.isRoot=!1,this.hasJumperStand=!1,this.tree=null,this.brick=null,this.pos=cc.v2(0,0),this.depth=0,this.bActionBrick=!1,this.nDirExtend=0,this.isDeathWay=!1,this.dir=t,this.isRoot=e}return Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){var e=t.child;-1===e.indexOf(this)&&(this._parent=t,e.push(this),this.calcuPos())},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this.parent=null,this.child=[],this.isRoot=!1,this.depth=0},t.prototype.calcuPos=function(){if(this.parent){var t=this.parent.pos,e=this.dir===n.BirckDir.right?62.5:-62.5,r=t.y+72,i=t.x+e;this.pos=cc.v2(i,r)}},t}();r.brickData=h;var u=function(){function t(){this.root=null,this.depth=0,this.brickDepthMap=new Map,this.brickNodes=[]}return t.prototype.grow=function(){this.depth+=1},t.prototype.add=function(t){var e=this.brickDepthMap.get(t.depth);e||(e=[],this.brickDepthMap.set(t.depth,e)),t.tree=this,e.push(t)},t.prototype.getBricksByDepth=function(t){return this.brickDepthMap.has(t)?this.brickDepthMap.get(t):[]},t.prototype.clear=function(){this.root=null,this.depth=0,this.brickDepthMap.clear(),this.brickNodes=[]},t}();r.brickTree=u;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.brickPfb=null,e.brickPool=new cc.NodePool("brick"),e.brickTree=null,e.fallDepth=0,e.isFalling=!1,e}return o(e,t),e.prototype.onLoad=function(){this.makeTree()},e.prototype.createDefaultBricks=function(){for(var t=0;t<8;++t)this.treeGrowth(!0)},e.prototype.getBrickTree=function(){return this.brickTree},e.prototype.getBrick=function(){var t=this.brickPool.get();return t||(t=this.createBrick()),t},e.prototype.createBrick=function(){return cc.instantiate(this.brickPfb)},e.prototype.treeGrowth=function(t){if(void 0===t&&(t=!1),!this.brickTree.root){var e=this.getRandomDir(),r=new h(e,!0);return this.brickTree.root=r,this.brickTree.grow(),r.depth=this.brickTree.depth,this.brickTree.add(r),void this.applyTreeGrowth()}var i=this.brickTree.getBricksByDepth(this.brickTree.depth);this.brickTree.grow();for(var o=0,c=i.length;o<c;++o){var n=i[o];n.nDirExtend>0?((r=new h(n.dir)).parent=n,r.depth=this.brickTree.depth,r.bActionBrick=!t,r.isDeathWay=n.isDeathWay,r.nDirExtend=n.nDirExtend-1,this.brickTree.add(r)):n.isDeathWay||this.freeBranchGrow(n,t)}this.applyTreeGrowth()},e.prototype.freeBranchGrow=function(t,e){var r=Math.random()>.05?1:2,i=[[n.BirckDir.left,n.BirckDir.right],[n.BirckDir.right,n.BirckDir.left]],o=Math.random()>=.5?i[0]:i[1],c=-1,s=0;2===r&&(c=Math.random()>=.5?0:1,s=3);for(var a=0;a<r;++a){var p=o[a],u=new h(p);u.parent=t,u.depth=this.brickTree.depth,u.bActionBrick=!e,u.isDeathWay=c===a,u.nDirExtend=s,this.brickTree.add(u)}},e.prototype.makeTree=function(){this.brickTree=new u},e.prototype.applyTreeGrowth=function(){this.brickTree.root&&this.makeBricks(this.brickTree.root)},e.prototype.makeBricks=function(t){if(!t.brick){var e=this.getBrick();e.stopAllActions(),e.parent=this.node,e.opacity=255,t.brick=e,e.setSiblingIndex(0),this.brickTree.brickNodes.push(e);var r=e.getComponent("brick");t.bActionBrick?(e.setPosition(t.pos.x,t.pos.y+800),cc.tween(e).to(.2,{y:t.pos.y}).call(function(){3==t.nDirExtend&&t.isDeathWay&&r&&r.showDeath()}).start()):(e.setPosition(t.pos),3==t.nDirExtend&&t.isDeathWay&&r&&r.showDeath(!0))}for(var i=t.child,o=0,c=i.length;o<c;++o)this.makeBricks(i[o])},e.prototype.clearTree=function(){for(var t=0,e=this.brickTree.brickNodes;t<e.length;t++){var r=e[t];this.brickPool.put(r)}this.brickTree.clear(),this.fallDepth=0},e.prototype.getRandomDir=function(){return Math.random()>.5?n.BirckDir.left:n.BirckDir.right},e.prototype.startFallBricks=function(){this.isFalling||(this.isFalling=!0,this.schedule(this.fallBricks,.25,cc.macro.REPEAT_FOREVER,1))},e.prototype.stopFalling=function(){this.isFalling=!1,this.unschedule(this.fallBricks)},e.prototype.fallBricks=function(){var t=this;this.fallDepth+=1;for(var e=function(e){var r=e.brick;cc.isValid(r)&&cc.tween(r).call(function(){cc.systemEvent.emit("brickFalling",e)}).by(.8,{y:-1e3,opacity:-255}).call(function(){t.brickPool.put(r)}).start()},r=0,i=this.brickTree.getBricksByDepth(this.fallDepth);r<i.length;r++)e(i[r]);this.resetRootBirckData()},e.prototype.resetRootBirckData=function(){this.brickTree.root=null;for(var t=this.fallDepth+1,e=this.brickTree.getBricksByDepth(t),r=0,i=e;r<i.length;r++){var o=i[r];if(o.hasJumperStand){this.brickTree.root=o;break}}this.brickTree.root||(this.brickTree.root=e[0]?e[0]:null)},c([p(cc.Prefab)],e.prototype,"brickPfb",void 0),c([a],e)}(cc.Component);r.default=l,cc._RF.pop()},{"./brick":"brick"}],brick:[function(t,e,r){"use strict";cc._RF.push(e,"f5a159r5wtJVpYQcvRqku8N","brick");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),c=this&&this.__decorate||function(t,e,r,i){var o,c=arguments.length,n=c<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(n=(c<3?o(n):c>3?o(e,r,n):o(e,r))||n);return c>3&&n&&Object.defineProperty(e,r,n),n};Object.defineProperty(r,"__esModule",{value:!0}),r.BirckDir=void 0;var n=cc._decorator,s=n.ccclass,a=n.property;r.BirckDir=cc.Enum({right:0,left:1});var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sp_death=null,e}return o(e,t),e.prototype.start=function(){},e.prototype.unuse=function(){cc.log("unuse"),this.node.stopAllActions(),this.sp_death.active=!1,this.sp_death.stopAllActions(),this.sp_death.y=0},e.prototype.showDeath=function(t){void 0===t&&(t=!1),this.sp_death.active=!0,this.sp_death.y=0;var e=t?0:.2;cc.tween(this.sp_death).to(e,{y:50}).start()},c([a(cc.Node)],e.prototype,"sp_death",void 0),c([s],e)}(cc.Component);r.default=p,cc._RF.pop()},{}],followCamera:[function(t,e,r){"use strict";cc._RF.push(e,"ced60NnbU1PxKO1zbRknxak","followCamera");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),c=this&&this.__decorate||function(t,e,r,i){var o,c=arguments.length,n=c<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(n=(c<3?o(n):c>3?o(e,r,n):o(e,r))||n);return c>3&&n&&Object.defineProperty(e,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});var n=cc._decorator,s=n.ccclass,a=n.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.targetNode=null,e.curTween=null,e}return o(e,t),e.prototype.onLoad=function(){cc.systemEvent.on("cameraFollow",this.excuteFollow,this)},e.prototype.start=function(){},e.prototype.excuteFollow=function(t){void 0===t&&(t=!1),this.clearTween();var e=this.targetNode.parent.convertToWorldSpaceAR(this.targetNode.position),r=cc.Canvas.instance.node.convertToNodeSpaceAR(e);r.y+=200;var i=t?0:.3;this.curTween=cc.tween(this.node).to(i,{position:r}),this.curTween.start()},e.prototype.onDestroy=function(){this.clearTween()},e.prototype.clearTween=function(){this.curTween&&(this.curTween.stop(),this.curTween=null)},c([a(cc.Node)],e.prototype,"targetNode",void 0),c([s],e)}(cc.Component);r.default=p,cc._RF.pop()},{}]},{},["Jumper","app","brick","brickMgr","followCamera"]);